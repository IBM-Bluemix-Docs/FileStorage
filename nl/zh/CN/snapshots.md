---

copyright:
  years: 2014, 2017
lastupdated: "2017-12-11"

---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}

# 使用快照

快照是 {{site.data.keyword.filestorage_full}} 的一项功能。快照表示特定时间点的卷内容。通过快照，既能保护数据，又不影响性能，而且使用空间量最小，因此快照被视为数据保护的第一道防线。如果用户意外修改或删除了卷中的关键数据，可以借助快照功能轻松、快速地从快照副本复原数据。

{{site.data.keyword.filestorage_short}} 提供了两种方法来生成快照：一种是通过可配置的快照安排来自动为每个存储卷创建和删除快照副本。您还可以根据需求来创建其他快照安排，手动删除副本和管理安排。另一种方法是生成手动快照。

快照副本是 {{site.data.keyword.filestorage_short}} 卷的只读图像，用于捕获卷在某个时间点的状态。快照副本在创建所需时间和存储空间方面效率极高。创建 {{site.data.keyword.filestorage_short}} 快照副本仅需要几秒钟时间 - 通常不到 1 秒，与卷的大小或存储器上的活动级别无关。创建快照副本后，对数据对象的更改将反映在当前对象版本的更新中，就像快照副本不存在一样。同时，数据的副本会保持完全稳定。 

快照副本不会产生性能开销；用户可以轻松地为每个 {{site.data.keyword.blockstorageshort}} 卷存储最多 50 个安排的快照和 50 个手动快照，所有这些快照都可以作为只读和联机版本的数据进行访问。

快照支持用户

- 以非破坏性方式创建时间点恢复点
- 将卷还原到先前的时间点
- 您必须为卷购买一些快照空间量才能生成该卷的快照。在初始卷订购期间或初始供应后，可以通过在“卷详细信息”页面中，单击“操作”下拉按钮，然后选择“添加快照空间”来添加快照空间。请注意，安排的快照和手动快照共享快照空间，因此请相应地订购空间。

## 快照最佳实践
快照设计取决于客户的环境。以下设计注意事项有助于您计划和实施快照副本： 
- 	在每个卷或 LUN 上，通过安排最多可以创建 50 个快照，并且通过手动方式最多可以创建 50 个快照。 
- 	不要过度频繁地生成快照。通过安排每小时、每天或每周快照，确保安排的快照频率满足 RTO 和 RPO 需求以及应用程序业务需求。 
- 	应使用“快照自动删除”来控制存储器消耗量的增长。<br/>
    **注**：“自动删除”阈值固定为 95%。
    
## 快照副本如何使用磁盘空间？
快照副本通过保留单个块而不是整个文件，使磁盘使用量尽可能最少。仅当更改或删除了活动文件系统中的文件时，快照副本才会开始使用额外的空间。发生这种情况时，原始文件块仍保留为一个或多个快照副本的一部分。
在活动文件系统中，更改的块会重写入磁盘上的其他位置，或者作为活动文件块整个除去。因此，除了修改后的活动文件系统中的块使用的磁盘空间之外，仍然会保留原始块使用的磁盘空间，以反映出更改前活动文件系统的状态。

<table>
    <colgroup>
      <col style="width: 33.3%;"/>
      <col style="width: 33.3%;"/>
      <col style="width: 33.3%;"/>
    </colgroup>
    <tbody>
      <tr>
        <th colspan="3" style="border: 0.0px;text-align: center;">生成快照副本前后的磁盘空间使用情况</th>
     </tr><tr>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle1.png" alt="生成快照副本前"></td>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle3.png" alt="生成快照副本后"></td>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle2.png" alt="生成快照副本后更改"></td>
     </tr><tr>
        <td style="border: 0.0px;">创建任何快照副本之前，磁盘空间仅由活动文件系统使用。</td>
        <td style="border: 0.0px;">创建快照副本之后，活动文件系统和快照副本将指向相同磁盘块。快照副本不会使用额外的磁盘空间。</td>
        <td style="border: 0.0px;">从活动文件系统中删除 <i>myfile.txt</i> 后，快照副本仍包含该文件并引用其磁盘块。这就是删除活动文件系统数据并不一定会释放磁盘空间的原因。</td>
      </tr>
    </tbody>
</table>



## 如何购买快照空间？

为了自动或手动创建存储卷的快照，您需要购买空间来保存快照。可以购买的最高容量等于存储卷容量（在初始卷购买期间或之后使用以下步骤）。

1. 通过 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.filestorage_short}}** 选项卡来访问存储器。
2. 单击“快照”框架中的“添加快照空间”链接。单击“快照”框架中的**立即购买快照空间**链接。
3. 单击相应空间量旁边的单选按钮来选择所需的空间量。
4. 单击**继续**。
5. 输入您拥有的任何促销代码，然后单击**重新计算**。此订单的费用和“订单复查”将具有缺省值。
6. 单击**我已阅读主服务协议...** 复选框，然后单击**下单**。快照空间将在几分钟后供应。

## 如何创建快照安排？

通过快照安排，您可以决定创建存储卷的时间点引用的频率和时间。每个存储卷最多可以有 50 个快照。安排可通过 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.filestorage_short}}** 选项卡进行管理。

如果在初始供应存储卷期间未购买快照空间，那么必须首先购买快照空间，然后才能设置初始安排。

### 添加快照安排

可以将快照安排的时间间隔设置为每小时、每天和每周，每种时间间隔使用不同的保留周期。每个存储卷最多可有 50 个安排的快照（可以混合使用每小时、每天和每周安排）和手动快照。

1. 单击存储卷，单击**操作**下拉框，然后单击**安排快照**。
2. 在“新建安排快照”对话框中，有三个不同的快照频率可供选择。使用这三项的任意组合来创建综合快照安排。
   - 每小时
      - 指定每小时内应执行快照的分钟；缺省值为当前分钟。
      - 指定在丢弃最旧快照之前要保留的每小时快照数。
   - 每天
      - 指定应执行快照的小时和分钟；缺省值为当前小时和分钟。
      - 选择在丢弃最旧快照之前要保留的每小时快照数。
   - 每周
      - 指定应执行快照的星期、小时和分钟；缺省值为当天、当前小时和分钟。
      - 选择在丢弃最旧快照之前要保留的每周快照数。
3. 单击**保存**，然后创建具有不同频率的其他安排。请注意，如果安排的快照总数超过 50，您将收到警告消息并且无法进行保存。

在生成快照时，会在“详细信息”页面的“快照”部分中显示快照列表。

## 如何生成手动快照？

手动快照可以在应用程序升级或维护期间在各种时间点生成。通过手动快照，还能够在多台计算机上生成在应用程序级别暂时失效的快照。

每个存储卷最多有 50 个手动快照。

1. 单击存储卷。
2. 单击“操作”下拉框。
3. 单击**生成手动快照**。
这将生成快照，并且快照会显示在“详细信息”页面的“快照”部分中。其安排将为“手动”。

## 如何查看快照列表以及使用的空间量和管理功能？

可以在“详细信息”页面（**存储** > **{{site.data.keyword.filestorage_short}}**）上查看保留的快照和已使用空间量的列表。管理功能（编辑安排和添加更多空间）是在**详细信息**页面上使用该页面上各部分中的**操作**下拉菜单或链接来执行。

## 如何查看保留快照的列表？

保留的快照数取决于设置安排时在**保留最后一项**字段中输入的数字。您可以在**快照**部分下查看已生成的快照。快照按安排列出。

## 如何查看已使用的快照空间量？

**详细信息**页面顶部的饼图显示已使用的空间量以及剩余的空间量。在开始达到空间阈值（75%、90% 和 95%）时，您会收到通知。

## 如何更改卷的快照空间量？

您可能需要向先前没有任何快照空间的卷添加快照空间，或者可能需要更多的快照空间。根据需要，可以添加 5 GB 到 4,000 GB。注：快照空间只能增大而不可减小。因此，在确定实际需要的空间量之前，您可能希望选择较小的空间量。请记住，自动快照和手动快照共享同一空间。

快照空间可通过**存储** > **{{site.data.keyword.filestorage_short}}** 进行更改。

1. 单击存储卷，单击**操作**下拉框，然后单击**添加更多快照空间**。
2. 从提示中的各种大小中进行选择。大小范围通常从 0 到卷大小。
3. 单击**继续**以供应更多空间。
4. 输入您拥有的任何促销代码，然后单击**重新计算**。**此订单的费用**和**订单复查**将显示缺省值。
5. 单击**我已阅读主服务协议...** 复选框，然后单击**下单**。更多快照空间将在几分钟后供应。

## 如何在接近快照空间限制以及删除快照时收到通知？

达到三个不同的空间阈值（75%、90% 和 95%）时，支持机构会通过支持凭单向帐户的主用户发送通知。

- 75% 容量：快照空间利用率超出 75% 时，会发送警告。如果您留意到警告并手动添加空间或删除保留的快照和不需要的快照，那么将记录相应操作并关闭凭单。如果不执行任何操作，那么必须手动确认该凭单，然后该凭单将关闭。
- 90% 容量：快照空间利用率超过 90% 时，会发送第二个警告。与达到 75% 容量时一样，如果执行必要的操作来减少使用的空间，那么将记录相应操作并关闭该凭单。如果不执行任何操作，那么必须手动确认该凭单，然后该凭单将关闭。
- 95% 容量：将发送最后的警告。如果未执行任何操作来使空间低于该阈值，那么将生成通知并执行自动删除，以便未来可以创建快照。这将删除安排的快照，从最旧的快照开始删除，直到使用率低于 95% 为止，并且每次利用率超过 95% 时，都会再次执行删除操作，直到利用率低于该阈值为止。如果以手动方式增大空间或删除快照，那么将重置警告，如果再次超过阈值，将重新发出警告。如果不执行任何操作，那么这是您会收到的唯一警告。

## 如何删除快照安排？

快照安排可通过**存储** > **{{site.data.keyword.filestorage_short}}** 来取消。

1. 单击**详细信息**页面上**快照安排**框架中要删除的安排。
2. 单击要删除的安排旁边的复选框，然后单击**保存**。<br/>
注意：如果要使用复制功能，请确保删除的安排不是复制所使用的安排。单击[此处](replication.html)以获取有关删除复制安排的更多信息。

## 如何删除快照？

可以手动除去不再需要的快照，以释放空间供未来快照使用。删除操作可通过**存储** > **{{site.data.keyword.filestorage_short}}** 来执行。

1. 单击存储卷，然后向下滚动到“快照”部分以查看现有快照的列表。
2. 单击特定快照旁边的“操作”下拉列表，然后单击**删除**以删除快照。这不会影响同一安排上的任何未来或过去的快照，因为快照之间不存在依赖关系。

未按上述方式删除的手动快照会在达到空间限制时自动删除（先删除最旧的快照）。

## 如何使用快照将存储卷复原到特定时间点？

由于用户错误或数据损坏，您可能需要将存储卷恢复到特定时间点。

1. 从主机卸装并拆离存储卷。
   - 单击[此处](accessing-file-storage-linux.html)以获取有关 Linux 上 {{site.data.keyword.filestorage_short}} 的指示信息。
2. 单击 [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} 中的**存储** > **{{site.data.keyword.filestorage_short}}**。
3. 向下滚动并单击要复原的卷。“详细信息”页面的“快照”部分将显示所有保存的快照及其大小和创建日期的列表。
4. 单击要使用的快照的**操作**按钮，然后单击**复原**。 

   **注**：执行复原将导致自生成所使用快照以来创建或修改的数据丢失。完成后，存储卷会恢复到生成此快照时的状态。系统将出现提示，通知您此状态。
5. 单击**是**以启动复原。您将在页面顶部收到一条消息，声明已使用所选快照复原了卷。此外，{{site.data.keyword.filestorage_short}} 上的相应卷旁边会显示一个图标，指示正在执行活动事务。将鼠标悬停在该图标上将生成一个用于指示事务的对话框。一旦事务完成后，该图标会消失。
6. 安装存储卷并将其重新连接到主机。
   - 单击[此处](accessing-file-storage-linux.html)以获取有关 Linux 上 {{site.data.keyword.filestorage_short}} 的指示信息。
   
**注**：复原卷会导致删除所复原快照之前的所有快照。

