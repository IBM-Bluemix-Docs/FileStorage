---

copyright:
  years: 2014, 2018
lastupdated: "2018-05-17"

---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
 
# {{site.data.keyword.filestorage_short}}から拡張{{site.data.keyword.filestorage_short}}へのマイグレーション

現在、拡張 {{site.data.keyword.filestorage_full}} は一部のデータ・センターでのみ提供されています。アップグレードされたデータ・センターと、調整可能な IOPS レートや拡張可能なボリュームなどの使用可能な機能のリストを確認するには、[ここ](new-ibm-block-and-file-storage-location-and-features.html)をクリックしてください。プロバイダー管理の暗号化ストレージについて詳しくは、[保存データの{{site.data.keyword.filestorage_short}}暗号化](block-file-storage-encryption-rest.html)の記事を参照してください。

お勧めするマイグレーション・パスは、両方の LUN に同時に接続して LUN 間で直接データを転送する方法です。 具体的な手順は、オペレーティング・システムと、コピー操作中にデータ変更が行われるかどうかによって異なります。 

ホストに非暗号化 LUN が既に接続されていることを前提としています。 接続されていない場合は、以下の説明のうち、ご使用のオペレーティング・システムに最も該当する説明に従って、このタスクを実行してください。

- [Linux への{{site.data.keyword.filestorage_short}}のマウント](accessing-file-storage-linux.html)
- [CentOS への NFS/{{site.data.keyword.filestorage_short}}のマウント](mounting-nsf-file-storage.html)
- [CoreOS への{{site.data.keyword.filestorage_short}}のマウント](mounting-storage-coreos.html)

**注:** すべての拡張{{site.data.keyword.filestorage_short}}・ボリュームは、非暗号化ボリュームとは異なるマウント・ポイントになります。暗号化と非暗号化の両方の{{site.data.keyword.filestorage_short}}・ボリュームに正しいマウント・ポイントを使用するために、UI の**「ボリュームの詳細 (Volume Details)」**ページでマウント・ポイント情報を確認することができます。API 呼び出し `SoftLayer_Network_Storage::getNetworkMountAddress()` を使用して正しいマウント・ポイントを取得することもできます。


## 新しい{{site.data.keyword.filestorage_short}}の作成

**重要**: API を使用して注文する場合は、「Storage as a Service」パッケージを指定して、更新済みの機能を新しいストレージと一緒に取得してください。

UI を使用して拡張ボリューム/ファイル共有を注文する手順を以下に示します。簡単にマイグレーションできるようにするには、新規ボリュームのサイズを元のボリュームのサイズ以上にする必要があります。

### 新規エンデュランス・ストレージ・ボリュームの注文

1. [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}で**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**をクリックするか、または {{site.data.keyword.BluSoftlayer_full}} カタログで**「インフラストラクチャー」** > **「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**をクリックします。
2. 右上隅にある**「{{site.data.keyword.filestorage_short}}を注文」**をクリックします。 
3. **「ストレージ・タイプの選択」**リストで**「エンデュランス」**を選択します。
4. **「ロケーション」**をクリックし、使用するデータ・センターを選択します。
   - 必ず、元のストレージと同じ場所に新しいストレージが追加されるようにしてください。
5. 請求オプションを選択します。月単位の請求または時間単位の請求を選択できます。
6. **「エンデュランス」**をクリックし、IOPS ティアを選択します。
6. リストから**「使用可能なストレージ・サイズ (Usable Storage Size)」**を選択します。 新規ボリュームのサイズを元のボリュームのサイズ以上にする必要があります。
7. ドロップダウン・リストから**「スナップショット・スペース・サイズ (Snapshot Space Size)」**(使用可能なスペースに追加されます) を選択します。
8. **「次へ進む (Continue)」**をクリックします。 月額と日割り額が表示されます。これが注文の詳細を確認できる最後の機会です。 注文を変更する場合は、**「戻る」**をクリックします。
9. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。
 
### 暗号化パフォーマンス・ストレージ・ボリュームの注文

1. [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}で**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**をクリックするか、または {{site.data.keyword.BluSoftlayer_full}} カタログで**「インフラストラクチャー」** > **「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**をクリックします。
2. 右上隅にある**「{{site.data.keyword.filestorage_short}}を注文」**をクリックします。 
3. 「ストレージ・タイプの選択」リストで**「パフォーマンス」**を選択します。
4. **「ロケーション」**をクリックし、使用するデータ・センターを選択します。
    -  必ず、元のストレージと同じ場所に新しいストレージが追加されるようにしてください。
5. 請求オプションを選択します。時間単位の請求または月単位の請求を選択できます。
6. 該当する**ストレージ・サイズ**の隣のラジオ・ボタンを選択します。
6. **「IOPS の指定」**フィールドに IOPS を入力します。
7. **「次へ進む (Continue)」**をクリックします。 月額と日割り額が表示されます。これが注文の詳細を確認できる最後の機会です。 注文を変更する場合は、**「戻る」**をクリックします。
8. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。

ストレージが 1 分もしないうちにプロビジョンされ、{{site.data.keyword.slportal}}の「{{site.data.keyword.filestorage_short}}」ページに表示されます。

 
## 新しい{{site.data.keyword.filestorage_short}}のホストへの接続

「許可」ホストとは、ボリュームに対するアクセス権を付与されたホストのことです。 ホストの許可がなければ、システムからストレージにアクセスすることも、ストレージを使用することもできません。

1. 新規ボリュームの名前をクリックします。
2. ページの**「許可ホスト」**セクションまでスクロールします。
3. ページの右側にある**「ホストの許可」**リンクをクリックします。 ボリュームにアクセスできるホストを選択します。

許可されたら、ボリュームをホストに接続します。

 
## スナップショットとレプリケーション

元のボリュームにスナップショットとレプリケーションを設定していましたか? そうであれば、元のボリュームと同じ設定で新しい暗号化ボリュームのレプリケーションとスナップショット・スペースをセットアップし、スナップショット・スケジュールを作成する必要があります。 

**注**: 暗号化できるようにターゲット・データ・センターがアップグレードされていない場合は、そのデータ・センターがアップグレードされるまで、新規ボリュームのレプリケーションを設定できません。

 
## データのマイグレーション

元の{{site.data.keyword.filestorage_short}}・ボリュームと暗号化{{site.data.keyword.filestorage_short}}・ボリュームの両方にホストが接続されているはずです。 そうでない場合は、以下のようにします。

- このドキュメントと参照資料の手順に従ったことを確認してください。
- 2 つのボリュームをホストに接続するための支援がさらに必要な場合は、サポート・チケットを開いてください。

### データに関する考慮事項

ここで、元の{{site.data.keyword.filestorage_short}}・ボリュームにあるデータのタイプと、そのデータを暗号化ボリュームにコピーする最適な方法について検討しましょう。 バックアップや静的コンテンツがあり、コピー中に変更がない場合は、特に考慮事項はありません。

{{site.data.keyword.filestorage_short}}上でデータベースまたは仮想マシンを実行している場合は、破損が発生しないように、コピー中は元のボリューム上のデータが変更されないようにしてください。 帯域幅に懸念がある場合は、非ピーク時にマイグレーションを行う必要があります。 これらの考慮事項に関して支援が必要な場合は、サポート・チケットを開いてください。

### Microsoft Windows

元の{{site.data.keyword.filestorage_short}}・ボリュームから暗号化ボリュームにデータをコピーするには、新しいストレージをフォーマットし、Windows エクスプローラーを使用してファイルをコピーしてください。

### Linux

`rsync` を使用してデータをコピーすることを検討していることでしょう。 コマンドの例を次に示します。

```
[root@server ~]# rsync -Pavzu /path/to/original/file/storage/* /path/to/encrypted/file/storage
```

一度 `--dry-run` フラグを指定してコマンドの例を使用し、パスの並びが正しいことを確認することをお勧めします。このプロセスが中断された場合は、最後にコピー中であった宛先ファイルを削除して、その宛先ファイルが最初から新規ロケーションにコピーされるようにする必要があります。

`--dry-run` フラグなしでこのコマンドが完了したら、データは暗号化{{site.data.keyword.filestorage_short}}・ボリュームにコピーされています。 スクロールアップしてコマンドを再度実行して、何も欠落していないことを確認する必要があります。 両方のロケーションを手動で確認して、欠落しているものがないか探すことをお勧めします。

マイグレーションが完了したら、実動環境を暗号化ボリュームに移し、構成から元のボリュームを切り離して削除することができます。 

**注**: 削除により、元のボリュームに関連付けられていたターゲット・サイト上のスナップショットやレプリカも除去されます。
