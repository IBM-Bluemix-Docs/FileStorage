---

copyright:
  years: 2018, 2019
lastupdated: "2019-02-05"

keywords: File Storage, file storage, NFS, disaster recovery, duplicate volume, replica volume, failover, failback,

subcollection: FileStorage

---
{:external: target="_blank" .external}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:important: .important}
{:DomainName: data-hd-keyref="APPDomain"}
{:DomainName: data-hd-keyref="DomainName"}

# 災害復旧 - プライマリー・ボリュームがアクセス可能である場合のフェイルオーバー
{: #dr-accessible}

1 次サイトで致命的な障害または災害が発生したものの、1 次ストレージにまだアクセスできる場合、お客様は以下の操作を実行して 2 次サイトのデータにすぐにアクセスすることができます。

フェイルオーバーを開始する前に、ホストの許可がすべて正しく設定されていることを確認してください。

許可ホストとボリュームは同じデータ・センターになければなりません。 例えば、レプリカ・ボリュームをロンドンに置いて、ホストをアムステルダムに置くことはできません。 両方がロンドンに、または両方がアムステルダムになければなりません。
{:note}

1. [{{site.data.keyword.cloud}} コンソール](https://{DomainName}/catalog){: external} にログインして、左上にある**「メニュー」**アイコンをクリックします。 **「クラシック・インフラストラクチャー」**を選択します。


   または、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){: external} にログインできます。
1. **「{{site.data.keyword.filestorage_short}}」**ページからソース・ボリュームまたは宛先ボリュームをクリックします。
2. **「レプリカ」**をクリックします。
3. **「ホストの許可」**フレームまでスクロールダウンして、右にある**「ホストの許可」**をクリックします。
4. レプリケーションを許可するホストを強調表示します。 複数のホストを選択するには、Ctrl キーを使用して目的のホストをクリックします。
5. **「送信」**をクリックします。 ホストがない場合は、同じデータ・センターでコンピュート・リソースを購入するよう求めるプロンプトが出されます。

## ボリュームからレプリカへのフェイルオーバーの開始

障害が発生した場合、宛先 (つまりターゲット) ボリュームへの**フェイルオーバー**を開始できます。 ターゲット・ボリュームがアクティブになります。 最後に正常に複製されたスナップショットがアクティブになり、ボリュームがマウント可能になります。 前回のレプリケーション・サイクル以降にソース・ボリュームに書き込まれたデータは、すべて失われます。 フェイルオーバーが開始すると、レプリケーションの関係が反転します。 ターゲット・ボリュームがソース・ボリュームになり、以前のソース・ボリュームは、**「LUN 名」**の後に **REP** を付けて示されるターゲットになります。

フェイルオーバーは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){: external} の**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**の下で開始されます。

これらのステップを続行する前に、ボリュームを切り離します。 そうしないと、破損やデータ損失が発生します。
{:important}

1. アクティブなボリューム (「ソース」) をクリックします。
2. 右上の**「レプリカ」**をクリックし、**「アクション」**をクリックします。
3. **「フェイルオーバー (Failover)」**を選択します。

   フェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.filestorage_short}}**のボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すウィンドウが表示されます。 トランザクションが完了すると、アイコンは消えます。 フェイルオーバー・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更は実行できません。 このイベントは、レプリケーション履歴に記録されます。<br/> ターゲット・ボリュームが稼働中の場合は、別のメッセージが表示されます。 元のソース・ボリュームの LUN 名が「REP」で終わるように更新され、その状況の表示が「非アクティブ」になります。
   {:note}
4. **「すべて表示 ({{site.data.keyword.filestorage_short}})」**をクリックします。
5. アクティブなボリューム (以前のターゲット・ボリューム) をクリックします。 これにより、このボリュームの状況が**「アクティブ」**になります。
6. ストレージ・ボリュームをホストにマウントして接続します。 [ここ](/docs/infrastructure/FileStorage?topic=FileStorage-orderingConsole)をクリックすると説明が表示されます。


## ボリュームからレプリカへのフェイルバックの開始

元のソース・ボリュームが修復されたら、元のソース・ボリュームへの制御されたフェイルバックを開始できます。 制御されたフェイルバックでは、以下が行われます。

- 稼働中のソース・ボリュームがオフラインになります。
- スナップショットが取得されます。
- レプリケーション・サイクルが完了します。
- 取得したばかりのデータ・スナップショットがアクティブになります。
- ソース・ボリュームがマウント用にアクティブになります。

フェイルバックが開始すると、レプリケーションの関係が再度反転します。 ソース・ボリュームがソース・ボリュームとしてリストアされ、ターゲット・ボリュームは、再度、**「LUN 名」**の後に **REP** を付けて示されるターゲット・ボリュームになります。

フェイルバックは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){: external} の**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**の下で開始されます。

1. アクティブなボリューム (「ターゲット」) をクリックします。
2. 右上の**「レプリカ」**をクリックし、**「アクション」**をクリックします。
3. **「フェイルバック」**を選択します。

   フェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.filestorage_short}}**のボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すウィンドウが表示されます。 トランザクションが完了すると、アイコンは消えます。 フェイルバック・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更は実行できません。 このイベントは、レプリケーション履歴に記録されます。
   {:note}
4. 右上にある**「すべての {{site.data.keyword.filestorage_short}} の表示」**リンクをクリックします。
5. アクティブなボリューム (「ソース」) をクリックします。
6. ストレージ・ボリュームをホストにマウントして接続します。 [ここ](/docs/infrastructure/FileStorage?topic=FileStorage-orderingConsole)をクリックすると説明が表示されます。
