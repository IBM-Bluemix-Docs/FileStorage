---

copyright:
  years: 2014, 2017
lastupdated: "2017-12-11"

---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}

# スナップショットの使用方法

スナップショットは、{{site.data.keyword.filestorage_full}} の機能です。スナップショットは、特定の時点のボリュームの内容を表します。スナップショットにより、パフォーマンスに影響を与えることなく、スペースの使用量を最小限に抑えながらデータを保護できます。スナップショットは、データ保護のための第一線の防御と見なされます。スナップショット機能を備えたボリュームから重要なデータをユーザーが誤って変更または削除した場合は、スナップショット・コピーからデータを素早く簡単にリストアできます。

{{site.data.keyword.filestorage_short}}には、スナップショットを取得する方法が 2 つあります。1 つ目は、ストレージ・ボリュームごとにスナップショット・コピーを自動的に作成、削除する構成可能なスナップショット・スケジュールを使用する方法です。追加のスナップショット・スケジュールを作成したり、手動でコピーを削除したり、要件に応じてスケジュールを管理したりすることもできます。2 つ目の方法は、手動でスナップショットを取得する方法です。

スナップショット・コピーとは、特定の時点のボリュームの状態をキャプチャーした、{{site.data.keyword.filestorage_short}}・ボリュームの読み取り専用イメージです。スナップショット・コピーは、作成に要する時間とストレージ・スペースの両方の面で非常に効率的です。ボリュームのサイズやストレージのアクティビティーのレベルに関係なく、{{site.data.keyword.filestorage_short}}・スナップショット・コピーの作成には数秒しかかかりません (通常 1 秒未満です)。スナップショット・コピーが作成された後、データ・オブジェクトに対する変更は、スナップショット・コピーが存在しないかのように、オブジェクトの現行バージョンに対する更新として反映されます。この間は、データのコピーは完全に安定したままです。 

スナップショット・コピーではパフォーマンス・オーバーヘッドは発生しません。ユーザーは、{{site.data.keyword.blockstorageshort}}・ボリュームごとにスケジュールによるスナップショット 50 個と手動スナップショット 50 個までを簡単に保管できます。これらはすべて読み取り専用のオンライン・バージョンのデータとしてアクセス可能です。

スナップショットは次を可能にします。

- 中断せずにポイント・イン・タイム・リカバリー・ポイントを作成できます。
- ボリュームを過去の特定の時点に戻せます。
- スナップショットを作成するには、ボリューム用に一定量のスナップショット・スペースを購入する必要があります。スナップショット・スペースはボリュームを最初に注文するときに追加できます。また、最初のプロビジョニングの後で、「ボリュームの詳細 (Volume Details)」ページで「アクション」ドロップダウン・ボタンをクリックし、「スナップショット・スペースの追加」を選択して追加することもできます。スケジュールされたスナップショットと手動スナップショットは同じスナップショット・スペースを使用するので、それに応じたスペースを注文してください。

## スナップショットのベスト・プラクティス
スナップショットの設計は、お客様の環境によって異なります。以下の設計上の考慮事項は、スナップショット・コピーの計画および実装に役立ちます。 
- 	ボリュームまたは LUN ごとに、スケジュールによるスナップショットを最大 50 個、手動によるスナップショットを最大 50 個作成できます。 
- 	スナップしすぎないように注意してください。時間単位、日単位、または週単位のスナップショットのスケジュールにより、RTO と RPO のニーズおよびアプリケーションのビジネス要件を満たす頻度のスナップショットをスケジュールします。 
- 	ストレージ消費量の増加を制御するために、スナップショットの自動削除を使用する必要があります。<br/>
    **注**: 自動削除のしきい値は 95% に固定されています。
    
## スナップショット・コピーがディスク・スペースを消費する方法
スナップショット・コピーは、ファイル全体ではなく個々のブロックを保存することでディスク使用量を最小化します。アクティブ・ファイル・システム内のファイルが変更または削除された場合にだけ、スナップショット・コピーは追加のスペースを消費し始めます。この場合、オリジナルのファイル・ブロックはまだ 1 つ以上のスナップショット・コピーの中に保存されています。
アクティブ・ファイル・システム内では、変更されたブロックが、ディスク上の別の場所に再書き込みされたり、アクティブ・ファイル・ブロックとして完全に削除されたりします。その結果、変更されたアクティブ・ファイル・システム内のブロックに使用されているディスク・スペースに加えて、元のブロックに使用されているディスク・スペースも、変更前のアクティブ・ファイル・システムの状況を表すために保持されます。

<table>
    <colgroup>
      <col style="width: 33.3%;"/>
      <col style="width: 33.3%;"/>
      <col style="width: 33.3%;"/>
    </colgroup>
    <tbody>
      <tr>
        <th colspan="3" style="border: 0.0px;text-align: center;">スナップショット・コピーの前および後のディスク・スペース使用量</th>
     </tr><tr>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle1.png" alt="スナップショット・コピーの前"></td>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle3.png" alt="スナップショット・コピーの後"></td>
        <td style="border: 0.0px;text-align: center;"><img src="/images/bfcircle2.png" alt="スナップショット・コピーの後の変更"></td>
     </tr><tr>
        <td style="border: 0.0px;">スナップショット・コピーが作成される前は、アクティブ・ファイル・システムだけがディスク・スペースを消費しています。</td>
        <td style="border: 0.0px;">スナップショット・コピーが作成された後は、アクティブ・ファイル・システムとスナップショット・コピーが同じディスク・ブロックを指しています。スナップショット・コピーは追加のディスク・スペースを使用しません。</td>
        <td style="border: 0.0px;"><i>myfile.txt</i> がアクティブ・ファイル・システムから削除された場合、スナップショット・コピーにはまだそのファイルが含まれていて、そのディスク・ブロックを参照しています。アクティブ・ファイル・システム・データを削除しても必ずディスク・スペースが解放されるわけではないのは、これが理由です。</td>
      </tr>
    </tbody>
</table>



## スナップショット・スペースの購入方法

ストレージ・ボリュームのスナップショットを自動または手動で作成するには、それらを保持するためのスペースを購入する必要があります。最大でストレージ・ボリュームの容量までの容量を (ボリュームの初期購入時に、または下記の手順を使用して購入後に) 購入できます。

1. [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**タブを使用してストレージにアクセスします。
2. 「スナップショット」フレームで「スナップショット・スペースの追加」リンクをクリックします。「スナップショット」フレームで**「今すぐスナップショット・スペースを購入」**リンクをクリックします。
3. 目的の容量の隣にあるラジオ・ボタンをクリックして、スペースの必要量を選択します。
4. **「次へ進む (Continue)」**をクリックします。
5. プロモーション・コードがある場合は入力し、**「再計算」**をクリックします。「この注文の課金」と「注文の検討」には、デフォルト値が表示されます。
6. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。スナップショット・スペースが数分後にプロビジョンされます。

## スナップショット・スケジュールの作成方法

スナップショット・スケジュールでは、ストレージ・ボリュームのポイント・イン・タイム・リファレンスを作成する頻度と時間を決定できます。ストレージ・ボリュームごとに最大 50 個のスナップショットを作成できます。スケジュールは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**タブで管理します。

ストレージ・ボリュームの初期プロビジョニング時にスナップショット・スペースを購入していなかった場合は、初期スケジュールをセットアップする前に、まず購入する必要があります。

### スナップショット・スケジュールの追加

スナップショット・スケジュールは、時間単位、日単位、週単位の間隔で、それぞれに異なる保持サイクルを指定してセットアップできます。ストレージ・ボリュームごとにスケジュール (時間単位、日単位、週単位のスケジュールが混在していてもかまいません) によるスナップショットと手動のスナップショットを最大 50 個作成できます。

1. ストレージ・ボリュームをクリックして、**「アクション」**ドロップダウン・ボックスをクリックし、**「スナップショットのスケジュール」**をクリックします。
2. 「新規スナップショット・スケジュール」ダイアログでは、3 つの異なるスナップショットの頻度から選択できます。3 つの頻度を任意に組み合わせて使用し、包括的なスナップショット・スケジュールを作成できます。
   - 時間単位
      - スナップショットを毎時実行する分を指定します。デフォルトは現在の分です。
      - 最も古いスナップショットを破棄するまで保持する毎時スナップショットの数を指定します。
   - 日単位
      - スナップショットを実行する時間と分を指定します。デフォルトは現在の時間と分です。
      - 最も古いスナップショットを破棄するまで保持する毎時スナップショットの数を選択します。
   - 週単位
      - スナップショットを実行する曜日、時間、分を指定します。デフォルトは現在の曜日、時間、分です。
      - 最も古いスナップショットを破棄するまで保持する週次スナップショットの数を選択します。
3. **「保存」**をクリックして、異なる頻度の別のスケジュールを作成します。スケジュールされたスナップショットの合計数が 50 個を超えると、警告メッセージを受け取り、保存できなくなることに注意してください。

スナップショットが「詳細」ページの「スナップショット」セクションに取り込まれると、それらのリストが表示されます。

## 手動スナップショットの取得方法

手動スナップショットは、アプリケーションのアップグレードまたは保守の際に、さまざまな時点で取得できます。また、アプリケーション・レベルで一時的に非アクティブ化した複数のマシン間でもスナップショットを取得できます。

ストレージ・ボリュームごとに最大 50 個の手動スナップショットがあります。

1. ストレージ・ボリュームをクリックします。
2. 「アクション」ドロップダウン・ボックスをクリックします。
3. **「手動スナップショットの取得」**をクリックします。
スナップショットが取得され、「詳細」ページの「スナップショット」セクションに表示されます。このスケジュールは手動になります。

## スナップショットのリストとスペース使用量および管理機能を表示する方法

保存されているスナップショットとスペース消費量のリストは、「詳細」ページ (**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**) で参照できます。管理機能 (スケジュールの編集とスペースの追加) は、この**「詳細」**ページのさまざまなセクションにある**「アクション」**ドロップダウン・メニューまたはリンクを使用して実行します。

## 保存されたスナップショットのリストを表示する方法

保存されているスナップショットは、スケジュールのセットアップ時に**「保持する最新の件数」**フィールドに入力した数に基づいています。**「スナップショット」**セクションで、取得されたスナップショットを表示できます。スナップショットは、スケジュール別にリストされます。

## 使用されているスナップショット・スペースの量を確認する方法

**「詳細」**ページの上部にある円グラフに、スペースの使用量と残りの量が表示されます。スペースしきい値 (75%、90%、95%) に近づくと、通知を受け取ります。
## ボリュームのスナップショット・スペースの量を変更する方法

スナップショット・スペースがこれまでなかったボリュームや、追加のスナップショット・スペースが必要なボリュームに、スナップショット・スペースを追加する必要がある場合があります。必要に応じて、5 GB から 4,000 GB を追加できます。注: スナップショット・スペースを増やすことはできますが、減らすことはできません。本当に必要なスペース量がわかるまで、少量のスペースを選択することをお勧めします。自動スナップショットと手動スナップショットは同じスペースを共有することに注意してください。

スナップショット・スペースは、**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で変更できます。

1. ストレージ・ボリュームをクリックして、**「アクション」**ドロップダウン・ボックスをクリックし、**「スナップショット・スペースの追加」**をクリックします。
2. プロンプトで、サイズの範囲から選択します。サイズの範囲は通常、0 からボリュームのサイズまでです。
3. **「次へ進む (Continue)」**をクリックして、追加スペースをプロビジョンします。
4. プロモーション・コードがある場合は入力し、**「再計算」**をクリックします。**「この注文の課金」**と**「注文の検討」**には、デフォルト値が表示されます。
5. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。追加されたスナップショット・スペースが数分後にプロビジョンされます。

## スナップショットのスペース制限に近づいたときとスナップショットが削除されたときに通知を受け取る方法

3 つの異なるスペースしきい値 (75%、90%、95%) に近づくと、サポートからアカウントのマスター・ユーザーへのサポート・チケットを使用して通知が送信されます。
- 75% の容量: スナップショット・スペース使用率が 75% を超えたことを示す警告が送信されます。警告に従い、スペースを手動で追加するか、保存されている不要なスナップショットを削除すると、そのアクションが認識されて、チケットはクローズされます。何も行わない場合は、チケットに手動で応答してからクローズする必要があります。
- 90% の容量: スナップショット・スペース使用率が 90% を超えると、2 番目の警告が送信されます。75% の容量に達した場合と同様に、使用スペースを減らすための必要なアクションを実行すると、そのアクションが認識されて、チケットはクローズされます。何も行わない場合は、チケットに手動で応答してからクローズする必要があります。
- 95% の容量: 最終の警告が送信されます。スペースをしきい値を下回るようにするためのアクションが実行されない場合、通知が生成されて、自動削除が実行され、今後もスナップショットを作成できるようになります。スケジュールされたスナップショットは、最も古いものから始めて、使用率が 95% を下回るまで削除され、使用率が 95% を超えるたびに、しきい値を下回るまで引き続き削除されます。スペースが手動で増やされるか、スナップショットが削除されると、警告はリセットされ、再びしきい値を超えた場合に再び発行されます。アクションが実行されない場合は、これが、受信する唯一の警告になります。

## スナップショット・スケジュールの削除方法

スナップショット・スペースは、**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**でキャンセルできます。

1. **「詳細」**ページの**「スナップショットのスケジュール」**フレームで、削除するスケジュールをクリックします。
2. 削除するスケジュールの隣にあるチェック・ボックスをクリックして、**「保存」**をクリックします。<br/>
注意: レプリケーション機能を使用している場合は、削除するスケジュールがレプリケーションで使用されているスケジュールでないことを確認してください。レプリケーション・スケジュールの削除について詳しくは、[ここ](replication.html)をクリックしてください。

## スナップショットの削除方法

不要になったスナップショットを手動で削除して、今後のスナップショット用にスペースを解放することができます。削除は、**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で行います。

1. ストレージ・ボリュームをクリックし、「スナップショット」セクションまでスクロールダウンして既存のスナップショットのリストを確認します。
2. 特定のスナップショットの隣にある「アクション」ドロップダウン・リストをクリックし、**「削除」**をクリックしてスナップショットを削除します。スナップショット間に依存関係はないため、この操作によって同じスケジュールによる将来または過去のスナップショットが影響を受けることはありません。

上記の方法で削除されない手動スナップショットは、スペース制限に達すると自動的に (古い順に) 削除されます。

## スナップショットを使用して特定時点にストレージ・ボリュームをリストアする方法

ユーザー・エラーやデータ破損が原因で、ストレージ・ボリュームを特定時点に戻す必要がある場合があります。

1. ストレージ・ボリュームをホストからアンマウントして切り離します。
   - [ここ](accessing-file-storage-linux.html)をクリックすると、Linux の{{site.data.keyword.filestorage_short}}についての説明が表示されます。
2. [{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}で、**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**をクリックします。
3. スクロールダウンして、リストアするボリュームをクリックします。「詳細」ページの「スナップショット」セクションに、保存されているすべてのスナップショットのサイズと作成日のリストが表示されます。
4. 使用するスナップショットの**「アクション」**ボタンをクリックして、**「リストア」**をクリックします。 

   **注**: リストアを実行すると、使用したスナップショットが作成された後に作成または変更されたデータは失われます。この操作の完了後、ストレージ・ボリュームは、スナップショットの作成時点と同じ状態に戻ります。これについて通知するプロンプトが表示されます。
5. リストアを開始するには、**「はい」**をクリックします。ページの上部に、選択したスナップショットを使用してボリュームがリストアされたことを示すメッセージが示されます。また、{{site.data.keyword.filestorage_short}}のボリュームの隣に、アクティブ・トランザクションが進行中であることを示すアイコンが表示されます。アイコン上にカーソルを移動すると、トランザクションを示すダイアログが表示されます。トランザクションが完了すると、アイコンは消えます。
6. ストレージ・ボリュームをホストにマウントして再接続します。
   - [ここ](accessing-file-storage-linux.html)をクリックすると、Linux の{{site.data.keyword.filestorage_short}}についての説明が表示されます。
   
**注**: ボリュームをリストアすると、リストアされたスナップショットより前のすべてのスナップショットが削除されます。

