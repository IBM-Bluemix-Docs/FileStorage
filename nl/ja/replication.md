---

copyright:
  years: 2015, 2018
lastupdated: "2018-05-22"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# レプリケーションの使用方法

レプリケーションでは、スナップショット・スケジュールの 1 つを使用して、スナップショットを自動的にリモート・データ・センター内の宛先ボリュームにコピーします。 災害やデータ破損が発生した場合に、リモート・サイトでコピーをリカバリーできます。

レプリカにより、以下が可能になります。

- 宛先ボリュームにフェイルオーバーして、サイト障害やその他の災害から素早く復旧する。
- DR コピーの特定の時点にフェイルオーバーする。

レプリケーションを行うには、その前にスナップショット・スケジュールを作成する必要があります。 フェイルオーバー時には、プライマリー・データ・センターのストレージ・ボリュームからリモート・データ・センターの宛先ボリュームにスイッチを「切り替え」ます。 例えば、プライマリー・データ・センターがロンドンにあり、セカンダリー・データ・センターがアムステルダムにあるとします。 障害が発生したら、アムステルダムにフェイルオーバーします。つまり、アムステルダムのコンピューティング・インスタンスにある新プライマリー・ボリュームに接続します。ロンドンのボリュームが修復されたら、ロンドンにフェイルバックしてロンドンのコンピューティング・インスタンスのボリュームをプライマリーに戻すために、アムステルダムのボリュームのスナップショットが作成されます。


## 複製ストレージ・ボリュームのリモート・データ・センターの決定方法

{{site.data.keyword.BluSoftlayer_full}} のデータ・センターは、世界的規模でプライマリーとリモートの組み合わせのペアを構成しています。
データ・センターの可用性とレプリケーションのターゲットの完全なリストについては、表 1 を参照してください。


<table style="width: 80.0%;">
	<caption style="text-align: left;"><p>表 1 - この表には、拡張機能を備えているすべてのデータ・センターを地域別にリストしています。地域ごとに列を分けています。ダラス、サンホセ、ワシントン DC、アムステルダム、フランクフルト、ロンドン、シドニーなどのいくつかの都市には、複数のデータ・センターがあります。</p>
		<p>&#42; 米国 1 地域のデータ・センターには、拡張ストレージがありません。拡張ストレージ機能を備えたデータ・センターのホストは、米国 1 のデータ・センターのレプリカ・ターゲットとのレプリケーションを開始<strong>できません</strong>。</p>
</caption>
	<thead>
		<tr>
			<th>米国 1 &#42;</th>
			<th>米国 2</th>
			<th>ラテンアメリカ</th>
			<th>カナダ</th>
			<th>ヨーロッパ</th>
			<th>アジア太平洋</th>
			<th>オーストラリア</t>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>DAL01<br />
				DAL05<br />
				DAL06<br />
				HOU02<br />
				SJC01<br />
				WDC01<br />
				<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>SJC03<br />
			       SJC04<br />
			       WDC04<br />
			       WDC06<br />
			       WDC07<br />
			       DAL09<br />
				DAL10<br />
				DAL12<br />
				DAL13<br />
				<br /><br />
			</td>
			<td>MEX01<br />
				SAO01<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>TOR01<br />
				MON01<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>
				AMS01<br />
				AMS03<br />
				FRA02<br />
				FRA04<br />
				FRA05<br />
				LON02<br />
				LON04<br />
				LON06<br />
				OSL01<br />
				PAR01<br />
				MIL01<br />
			</td>
			<td>HKG02<br />
				TOK02<br />
				SNG01<br />
				SEO01<br />
                                CHE01<br />
				<br />
				<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>
				SYD01<br />
				SYD04<br />
				MEL01<br />
				<br /><br /><br /><br /><br /><br /><br /><br />
			</td>
		</tr>
	</tbody>
</table>


## 初期レプリケーションの作成方法

レプリケーションは、スナップショット・スケジュールから機能します。 レプリケーションを実行するには、その前にソース・ボリュームにスナップショット・スペースとスナップショット・スケジュールをセットアップする必要があります。 どちらかが存在しないのにレプリケーションをセットアップしようとすると、スペースの購入またはスケジュールのセットアップが必要であることを示すプロンプトが表示されます。 レプリケーションは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で管理されます。

1. ストレージ・ボリュームをクリックします。
2. **「レプリカ」**タブをクリックして、**「レプリケーションを購入 (Purchase a replication)」**リンクをクリックします。
3. レプリケーションに使用する既存のスナップショット・スケジュールを選択します。 リストには、すべてのアクティブなスナップショット・スケジュールが入っています。
  **注:**: 時間単位、日単位、週単位が混在していても、選択できるスケジュールは 1 つだけです。  前回のレプリケーション・サイクル以降にキャプチャーされたすべてのスナップショットが、開始したスケジュールに関係なく複製されます。
4. **「ロケーション」**ドロップダウンの矢印をクリックして、DR サイトにするデータ・センターを選択します。
5. **「次へ進む (Continue)」**をクリックします。
6. **プロモーション・コード**がある場合は入力し、**「再計算」**をクリックします。 ダイアログ・ボックスのその他のフィールドはデフォルトになります。
7. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。


## 既存のレプリケーションの編集方法

[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から、**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**の下にある**「プライマリー」**または**「レプリカ」**タブで、レプリケーション・スケジュールを編集してレプリケーション・スペースを変更できます。


## レプリケーション・スケジュールの編集方法

レプリケーション・スケジュールは既存のスナップショット・スケジュールに基づいているため、実際にはスナップショット・スケジュールを変更することになります。 例えば、レプリケーション・スケジュールを時間単位から週単位に変更するには、レプリケーション・スケジュールをキャンセルして新規スケジュールをセットアップする必要があります。

スケジュールの変更は、**「プライマリー」**タブまたは**「レプリカ」**タブで実行できます。

1. **「プライマリー」**タブまたは**「レプリカ」**タブで**「アクション」**メニューをクリックします。
2. **「スナップショット・スケジュールの編集」**を選択します。
3. 「スケジュール」の「スナップショット」フレームで、レプリケーションに使用しているスケジュールを確認します。 レプリケーションに使用しているスケジュールを変更します。 例えば、レプリケーション・スケジュールが**「日単位」**である場合は、レプリケーションの実行時刻を変更できます。
4. **「保存」**をクリックします。


## レプリケーション・スペースの変更方法

プライマリー・スナップショット・スペースとレプリケーション・スペースは同じでなければなりません。 **「プライマリー」**タブまたは**「レプリカ」**タブでスペースを変更すると、ソースと宛先の両方のデータ・センターにスペースが自動的に追加されます。 スナップショット・スペースを増やすと、即時にレプリケーションの更新がトリガーされることに注意してください。

1. **「プライマリー」**タブまたは**「レプリカ」**タブで**「アクション」**メニューをクリックします。
2. **「スナップショット・スペースの追加」**を選択します。
3. ストレージ・サイズを選択して、**「次へ進む (Continue)」**をクリックします。
4. **プロモーション・コード**がある場合は入力し、**「再計算」**をクリックします。 ダイアログ・ボックスのその他のフィールドはデフォルトになります。
5. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。


## ボリューム・リストでレプリカ・ボリュームを確認する方法

**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**の下の「{{site.data.keyword.filestorage_short}}」ページでレプリケーション・ボリュームを確認できます。 ボリューム名は、プライマリー・ボリューム名の後に REP が付けられたものです。 「タイプ」は「エンデュランス (パフォーマンス) - レプリカ」です。レプリカ・ボリュームはレプリカ・データ・センターにマウントされていないため、「ターゲット・アドレス」は N/A です。「状況」は「非アクティブ」です。



## レプリカ・データ・センターにある複製ボリュームの詳細を表示する方法

**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**の下の**「レプリカ」**タブで、レプリカ・ボリュームの詳細を確認できます。 もう 1 つの方法としては、**「{{site.data.keyword.filestorage_short}}」**ページからレプリカ・ボリュームを選択して、**「レプリカ」**タブをクリックします。



## セカンダリー・データ・センターへのフェイルオーバーの前にホスト許可を指定する方法

許可ホストとボリュームは同じデータ・センターになければなりません。 レプリカ・ボリュームをロンドンに置いて、ホストをアムステルダムに置くことはできません。両方がロンドンに、または両方がアムステルダムになければなりません。

1. **「{{site.data.keyword.filestorage_short}}」**ページでソース・ボリュームまたは宛先ボリュームをクリックします。
2. **「レプリカ」**タブをクリックします。
3. **「ホストの許可」**フレームまでスクロールして、右にある**「ホストの許可」**をクリックします。
4. レプリケーションを許可するホストを強調表示します。 複数のホストを選択するには、Ctrl キーを使用して目的のホストをクリックします。
5. **「送信」**をクリックします。 ホストがない場合は、ダイアログ・ボックスに、同じデータ・センターでコンピューティング・リソースを購入するオプションが表示されます。あるいは、**「閉じる」**をクリックすることもできます。


## プライマリー・データ・センターのスペースを増やす場合にレプリカ・データ・センターのスナップショット・スペースを増やす方法

ボリューム・サイズは、プライマリーとレプリカのストレージ・ボリュームで同じでなければなりません。一方がもう一方よりも大きくてはなりません。 プライマリー・ボリュームのスナップショット・スペースを増やすと、レプリカ・スペースは自動的に増えます。 スナップショット・スペースを増やすと、即時にレプリケーションの更新がトリガーされることに注意してください。 両方のボリュームの増加が、請求書に品目として表示され、必要に応じて日割り計算されます。

スナップショット・スペースを増やす方法については、[ここ](snapshots.html)をクリックしてください。

## ボリュームからレプリカへのフェイルオーバーを開始する方法

障害が発生したら、宛先ボリューム、つまりターゲット・ボリュームへの**フェイルオーバー**を開始できます。ターゲット・ボリュームがアクティブになります。最後に正常に複製されたスナップショットがアクティブになり、ボリュームがマウント可能になります。前回のレプリケーション・サイクル以降にソース・ボリュームに書き込まれたデータはすべて破棄されます。 フェイルオーバーが開始された後は、レプリケーション関係が反転することに注意してください。 ターゲット・ボリュームがソース・ボリュームになり、ソース・ボリュームだったものが、元の LUN 名の後に **REP** が付いたターゲットになります。

フェイルオーバーは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で開始されます。

**このプロセスを先に進める前に、ボリュームを切断することをお勧めします。 そうしないと、破損やデータ損失が発生します。**

1. アクティブな LUN (「ソース」) をクリックします。
2. 「レプリカ」タブをクリックして、右上隅の**「アクション」**をクリックします。
3. **「フェイルオーバー (Failover)」**を選択します。フェイルオーバーが進行中であることを示すメッセージが、上部に表示されます。また、**{{site.data.keyword.filestorage_short}}**のボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すダイアログが表示されます。 トランザクションが完了すると、アイコンは消えます。 フェイルオーバー・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更などは実行できません。このイベントは、レプリケーション履歴に記録されます。
4. ターゲット・ボリュームが稼働すると、元のソース・ボリュームの LUN 名が「REP」を含むように更新され、その状況の表示が「非アクティブ」になります。
4. 右上隅にある**「すべての{{site.data.keyword.filestorage_short}}の表示」**リンクをクリックします。
5. アクティブな LUN (以前のターゲット・ボリューム) をクリックします。 このボリュームの状況は**「アクティブ」**になっています。
6. ストレージ・ボリュームをホストにマウントして接続します。


## ボリュームからレプリカへのフェイルバックを開始する方法

元のソース・ボリュームが修復されたら、**フェイルバック**・アクションを使用して、制御された方法で元のソース・ボリュームへのフェイルバックを開始できます。 制御されたフェイルバックでは、以下が行われます。

- 稼働中のソース・ボリュームがオフラインに変更されます
- スナップショットが取得されます。
- レプリケーション・サイクルが実行されます。
- 作成されたばかりのデータ・スナップショットがアクティブ化されます。
- そして、ソース・ボリュームがマウント用にアクティブ化されます。

フェイルバックが開始されると、レプリケーション関係が再び反転することに注意してください。ソース・ボリュームがソース・ボリュームとしてリストアされ、ターゲット・ボリュームが再び LUN 名の後に **REP** が付いたターゲット・ボリュームになります。

フェイルバックは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で開始します。

1. アクティブなエンデュランス LUN (「ターゲット」) をクリックします。
2. **「レプリカ」**タブをクリックして、右上隅の**「アクション」**をクリックします。
3. **「フェイルバック (failback)」**を選択します。
   フェイルオーバーが進行中であることを示すメッセージが、ページの上部に表示されます。また、ボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すダイアログが表示されます。 トランザクションが完了すると、アイコンは消えます。 <br /> フェイルバック・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更などは実行できません。 このイベントは、レプリケーション履歴に記録されます。
5. ソース・ボリュームが稼働すると、ターゲット・ボリュームが非アクティブになります。
4. 右上隅にある**「すべての{{site.data.keyword.filestorage_short}}の表示」**をクリックします。
5. アクティブな LUN (ソース) をクリックします。 このボリュームの状況は**「アクティブ」**になっています。
6. ストレージ・ボリュームをホストにマウントして接続します。 [ここ](provisioning-file-storage.html)をクリックすると説明が表示されます。


## レプリケーション履歴の表示方法

レプリケーション履歴は、**「管理」**の**「アカウント」**タブ上の**「監査ログ」**で表示できます。プライマリーとレプリカの両方のボリュームに、同一のレプリケーション履歴が表示されます。以下の項目が示されます。

- レプリケーションのタイプ (フェイルオーバーまたはフェイルバック)
- 開始日時
- レプリケーションに使用されたスナップショット
- レプリケーションのサイズ
- 完了日時


## 既存のレプリケーションをキャンセルする方法

キャンセルはただちに実行することも、請求が終了する応当日に実行することもできます。 レプリケーションのキャンセルは、**「プライマリー」**タブまたは**「レプリカ」**タブで実行できます。

1. **「{{site.data.keyword.filestorage_short}}」**ページからボリュームをクリックします。
2. **「プライマリー」**タブまたは**「レプリカ」**タブで、**「アクション」**をクリックします。
3. **「レプリカのキャンセル」**を選択します。
4. キャンセルするタイミングを選択します。**「即時」**または**「請求料金の確定日」**を選択し、**「続行」**をクリックしてください。
5. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**チェック・ボックスをクリックして、**「レプリカのキャンセル」**をクリックします。


## プライマリー・ボリュームをキャンセルするときにレプリケーションをキャンセルする方法

　プライマリー・ボリュームがキャンセルされると、レプリカ・データ・センターのレプリケーション・スケジュールとボリュームは削除されます。 レプリカは、**「{{site.data.keyword.filestorage_short}}」**ページからキャンセルされます。

 1. **「{{site.data.keyword.filestorage_short}}」**ページでボリュームを強調表示します。
 2. **「アクション」**をクリックし、**「{{site.data.keyword.filestorage_short}}のキャンセル (Cancel for {{site.data.keyword.filestorage_short}})」**を選択します。
 3. ボリュームをキャンセルするタイミングを選択します。**「即時」**または**「請求料金の確定日」**を選択し、**「続行」**をクリックしてください。
 4. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**チェック・ボックスをクリックして、**「キャンセル」**をクリックします。
