---

copyright:
  years: 2015, 2018
lastupdated: "2018-09-17"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# データのレプリケーション

レプリケーションでは、スナップショット・スケジュールの 1 つを使用して、スナップショットを自動的にリモート・データ・センター内の宛先ボリュームにコピーします。 壊滅的なイベントが発生した場合やデータが破損した場合、コピーをリモート・サイトでリカバリーすることができます。

レプリカにより、以下が可能になります。

- 宛先ボリュームにフェイルオーバーして、サイト障害やその他の災害から素早く復旧する。
- DR コピーの特定の時点にフェイルオーバーする。

レプリケーションを行うには、その前にスナップショット・スケジュールを作成する必要があります。 フェイルオーバー時には、プライマリー・データ・センターのストレージ・ボリュームからリモート・データ・センターの宛先ボリュームにスイッチを「切り替え」ます。 例えば、プライマリー・データ・センターがロンドンにあり、セカンダリー・データ・センターがアムステルダムにあるとします。 障害が発生したら、アムステルダムにフェイルオーバーします。つまり、アムステルダムのコンピューティング・インスタンスにある新プライマリー・ボリュームに接続します。 ロンドンのボリュームが修復されたら、ロンドンにフェイルバックしてロンドンのコンピューティング・インスタンスのボリュームをプライマリーに戻すために、アムステルダムのボリュームのスナップショットが作成されます。


## 複製ストレージ・ボリュームのリモート・データ・センターの判別

{{site.data.keyword.BluSoftlayer_full}} のデータ・センターは、世界的規模でプライマリーとリモートの組み合わせのペアを構成しています。
データ・センターの可用性とレプリケーションのターゲットの完全なリストについては、表 1 を参照してください。

<table>
	<caption style="text-align: left;"><p>表 1 - この表には、拡張機能を備えているすべてのデータ・センターを地域別にリストしています。 地域ごとに列を分けています。 ダラス、サンホセ、ワシントン DC、アムステルダム、フランクフルト、ロンドン、シドニーなどのいくつかの都市には、複数のデータ・センターがあります。</p>
		<p>&#42; 米国 1 地域のデータ・センターには、拡張ストレージがありません。 拡張ストレージ機能を備えたデータ・センターのホストは、米国 1 のデータ・センターのレプリカ・ターゲットとのレプリケーションを開始<strong>できません</strong>。</p>
</caption>
	<thead>
		<tr>
			<th>米国 1 &#42;</th>
			<th>米国 2</th>
			<th>ラテンアメリカ</th>
			<th>カナダ</th>
			<th>ヨーロッパ</th>
			<th>アジア太平洋</th>
			<th>オーストラリア</t>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>DAL01<br />
				DAL05<br />
				DAL06<br />
				HOU02<br />
				SJC01<br />
				WDC01<br />
				<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>SJC03<br />
			       SJC04<br />
			       WDC04<br />
			       WDC06<br />
			       WDC07<br />
			       DAL09<br />
				DAL10<br />
				DAL12<br />
				DAL13<br />
				<br /><br />
			</td>
			<td>MEX01<br />
				SAO01<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>TOR01<br />
				MON01<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>
				AMS01<br />
				AMS03<br />
				FRA02<br />
				FRA04<br />
				FRA05<br />
				LON02<br />
				LON04<br />
				LON06<br />
				OSL01<br />
				PAR01<br />
				MIL01<br />
			</td>
			<td>HKG02<br />
				TOK02<br />
        TOK04<br />
        TOK05<br/>
				SNG01<br />
				SEO01<br />
        CHE01<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>
				SYD01<br />
				SYD04<br />
				MEL01<br />
				<br /><br /><br /><br /><br /><br /><br /><br />
			</td>
		</tr>
	</tbody>
</table>


## 初期レプリカの作成

レプリケーションは、スナップショット・スケジュールに基づいて作動します。レプリケーションを実行するには、その前にまずソース・ボリューム用のスナップショット・スペースとスナップショット・スケジュールを準備する必要があります。レプリケーションをセットアップしようとして、そのいずれかが準備されていない場合には、より多くのスペースを購入するか、スケジュールをセットアップするようプロンプトが出されます。レプリケーションは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**で管理されます。

1. ストレージ・ボリュームをクリックします。
2. **「レプリカ」**をクリックし、**「レプリケーションの購入 (Purchase a replication)」**をクリックします。
3. レプリケーションに使用する既存のスナップショット・スケジュールを選択します。 リストには、すべてのアクティブなスナップショット・スケジュールが入っています。 <br />
   >**注** - 時間単位、日単位、週単位が混在していても、選択できるスケジュールは 1 つだけです。 前回のレプリケーション・サイクル以降に収集されたすべてのスナップショットが、それらを生成したスケジュールに関係なく複製されます。<br />スナップショットがセットアップされていない場合は、それをセットアップしてからレプリケーションを注文するように求めるプロンプトが表示されます。詳しくは、[スナップショットの処理](snapshots.html)を参照してください。
3. **「ロケーション」**をクリックして、DR サイトにするデータ・センターを選択します。
4. **「次へ進む (Continue)」**をクリックします。
5. **プロモーション・コード**がある場合は入力し、**「再計算」**をクリックします。 ウィンドウ内のその他のフィールドは、デフォルトで入力されています。
6. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。


## 既存のレプリケーションの編集

[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から、**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**の下にある**「プライマリー」**または**「レプリカ」**タブで、レプリケーション・スケジュールを編集してレプリケーション・スペースを変更できます。


## レプリケーション・スケジュールの編集

レプリケーション・スケジュールは既存のスナップショット・スケジュールに基づいています。 例えば、レプリケーション・スケジュールを時間単位から週単位に変更するには、レプリケーション・スケジュールをキャンセルして新規スケジュールをセットアップする必要があります。

スケジュールの変更は、「プライマリー」タブまたは「レプリカ」タブで実行できます。

1. **「プライマリー」**タブまたは**「レプリカ」**タブで、**「アクション」**をクリックします。
2. **「スナップショット・スケジュールの編集」**を選択します。
3. **「スケジュール」**の**「スナップショット」**フレームで、レプリケーションに使用しているスケジュールを確認します。 必要に応じてスケジュールを変更します。例えば、レプリケーション・スケジュールが**「日単位」**である場合は、レプリケーションが実行される時刻を変更できます。
4. **「保存」**をクリックします。


## レプリケーション・スペースの変更

プライマリー・スナップショット・スペースとレプリケーション・スペースは同じでなければなりません。 **「プライマリー」**タブまたは**「レプリカ」**タブでスペースを変更すると、ソースと宛先の両方のデータ・センターにスペースが自動的に追加されます。 スナップショット・スペースを増やすと、レプリケーションの即時更新もトリガーされます。

1. **「プライマリー」**タブまたは**「レプリカ」**タブで、**「アクション」**をクリックします。
2. **「スナップショット・スペースの追加」**を選択します。
3. リストからストレージ・サイズを選択して、**「次へ進む (Continue)」**をクリックします。
4. **プロモーション・コード**がある場合は入力し、**「再計算」**をクリックします。 ダイアログ・ボックスのその他のフィールドは、デフォルトで入力されています。
5. **「マスター・サービス契約を読み…」**チェック・ボックスをクリックし、**「注文する」**をクリックします。


## ボリューム・リストでのレプリカ・ボリュームの表示

**「ストレージ」**>**「{{site.data.keyword.filestorage_short}}」**の下の「{{site.data.keyword.filestorage_short}}」ページでレプリケーション・ボリュームを確認できます。ボリューム名には、プライマリー・ボリュームの名前とそれに続いて REP が表示されます。**「タイプ」**は、「エンデュランス - レプリカ」または「パフォーマンス - レプリカ」です。**「ターゲット・アドレス」**は、「N/A」であり (レプリカ・ボリュームはレプリカ・データ・センターでマウントされていないため)、**「状況」**には「非アクティブ」と表示されます。



## レプリカ・データ・センターでの複製されたボリュームの詳細の表示

**「ストレージ」** > **「{{site.data.keyword.filestorage_short}}」**の下の**「レプリカ」**タブで、レプリカ・ボリュームの詳細を確認できます。 もう 1 つの方法としては、**「{{site.data.keyword.filestorage_short}}」**ページからレプリカ・ボリュームを選択して、**「レプリカ」**タブをクリックします。


## サーバーが 2 次データ・センターにフェイルオーバーする前のホスト許可の指定

許可ホストとボリュームは同じデータ・センターになければなりません。 レプリカ・ボリュームをロンドンに置いて、ホストをアムステルダムに置くことはできません。 両方がロンドンに、または両方がアムステルダムになければなりません。

1. **「{{site.data.keyword.filestorage_short}}」**ページからソース・ボリュームまたは宛先ボリュームをクリックします。
2. **「レプリカ」**をクリックします。
3. **「ホストの許可」**フレームまでスクロールダウンして、右にある**「ホストの許可」**をクリックします。
4. レプリケーションを許可するホストを強調表示します。 複数のホストを選択するには、Ctrl キーを使用して目的のホストをクリックします。
5. **「送信」**をクリックします。 ホストがない場合は、同じデータ・センターでコンピュート・リソースを購入するよう求めるプロンプトが出されます。


## 1 次データ・センター内のスナップショット・スペースが増加するときにレプリカ・データ・センター内のスナップショット・スペースも増加する

ボリューム・サイズは、プライマリーとレプリカのストレージ・ボリュームで同じでなければなりません。 一方がもう一方よりも大きくてはなりません。 プライマリー・ボリュームのスナップショット・スペースを増やすと、レプリカ・スペースは自動的に増えます。 スナップショット・スペースを増やすと、レプリケーションの即時更新がトリガーされます。両方のボリュームの増加が、請求書に品目として表示され、必要に応じて日割り計算されます。

スナップショット・スペースを増やす方法については、[ここ](snapshots.html)をクリックしてください。


## ボリュームからレプリカへのフェイルオーバーの開始

障害が発生した場合、宛先 (つまりターゲット) ボリュームへの**フェイルオーバー**を開始できます。ターゲット・ボリュームがアクティブになります。 最後に正常に複製されたスナップショットがアクティブになり、ボリュームがマウント可能になります。前回のレプリケーション・サイクル以降にソース・ボリュームに書き込まれたデータは、すべて失われます。フェイルオーバーが開始すると、レプリケーションの関係が反転します。ターゲット・ボリュームがソース・ボリュームになり、以前のソース・ボリュームは、**「LUN 名」**の後に **REP** を付けて示されるターゲットになります。

フェイルオーバーは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**の下で開始されます。

**これらのステップを続行する前に、ボリュームを切り離します。そうしないと、破損やデータ損失が発生します。**

1. アクティブなボリューム (「ソース」) をクリックします。
2. 右上の**「レプリカ」**をクリックし、**「アクション」**をクリックします。
3. **「フェイルオーバー (Failover)」**を選択します。
   >フェイルオーバーが進行中であることを示すメッセージが表示されます。また、**{{site.data.keyword.filestorage_short}}**のボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すウィンドウが表示されます。トランザクションが完了すると、アイコンは消えます。 フェイルオーバー・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更は実行できません。 このイベントは、レプリケーション履歴に記録されます。<br/> ターゲット・ボリュームが稼働中の場合は、別のメッセージが表示されます。元のソース・ボリュームの LUN 名が「REP」で終わるように更新され、その状況の表示が「非アクティブ」になります。
4. **「すべて表示 ({{site.data.keyword.filestorage_short}})」**をクリックします。
5. アクティブなボリューム (以前のターゲット・ボリューム) をクリックします。 これにより、このボリュームの状況が**「アクティブ」**になります。
6. ストレージ・ボリュームをホストにマウントして接続します。 [ここ](provisioning-file-storage.html)をクリックすると説明が表示されます。


## ボリュームからレプリカへのフェイルバックの開始

元のソース・ボリュームが修復されたら、元のソース・ボリュームへの制御されたフェイルバックを開始できます。制御されたフェイルバックでは、以下が行われます。

- 稼働中のソース・ボリュームがオフラインになります。
- スナップショットが取得されます。
- レプリケーション・サイクルが完了します。
- 取得したばかりのデータ・スナップショットがアクティブになります。
- ソース・ボリュームがマウント用にアクティブになります。

フェイルバックが開始すると、レプリケーションの関係が再度反転します。ソース・ボリュームがソース・ボリュームとしてリストアされ、ターゲット・ボリュームは、再度、**「LUN 名」**の後に **REP** を付けて示されるターゲット・ボリュームになります。

フェイルバックは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の**「ストレージ」**、**「{{site.data.keyword.filestorage_short}}」**の下で開始されます。

1. アクティブなボリューム (「ターゲット」) をクリックします。
2. 右上の**「レプリカ」**をクリックし、**「アクション」**をクリックします。
3. **「フェイルバック」**を選択します。
   >フェイルオーバーが進行中であることを示すメッセージが表示されます。また、**{{site.data.keyword.filestorage_short}}**のボリュームの隣に、アクティブ・トランザクションが行われていることを示すアイコンが表示されます。 アイコン上にカーソルを移動すると、トランザクションを示すウィンドウが表示されます。トランザクションが完了すると、アイコンは消えます。 フェイルバック・プロセス中、構成関連のアクションは読み取り専用になります。 スナップショット・スケジュールの編集やスナップショット・スペースの変更は実行できません。 このイベントは、レプリケーション履歴に記録されます。
4. 右上にある**「すべての {{site.data.keyword.filestorage_short}} の表示」**リンクをクリックします。
5. アクティブなボリューム (「ソース」) をクリックします。
6. ストレージ・ボリュームをホストにマウントして接続します。 [ここ](provisioning-file-storage.html)をクリックすると説明が表示されます。


## レプリケーション履歴の表示

レプリケーション履歴は、**「管理」**の**「アカウント」**タブ上の**「監査ログ」**で表示できます。 プライマリーとレプリカの両方のボリュームに、同一のレプリケーション履歴が表示されます。以下の項目が示されます。

- レプリケーションのタイプ (フェイルオーバーまたはフェイルバック)。
- 開始日時
- レプリケーションに使用されたスナップショット。
- レプリケーションのサイズ。
- 完了日時。


## レプリカの複製の作成

既存の {{site.data.keyword.BluSoftlayer_full}} {{site.data.keyword.blockstoragefull}} の複製を作成できます。複製ボリュームは元の LUN/ボリュームの容量とパフォーマンスのオプションをデフォルトで継承し、スナップショットの時点までのデータの複製を保管します。

複製はプライマリー・ボリュームからでもレプリカ・ボリュームからでも作成できます。 新しい複製は元のボリュームと同じデータ・センターに作成されます。 レプリカ・ボリュームから複製を作成した場合、新規ボリュームはレプリカ・ボリュームと同じデータ・センターに作成されます。

ストレージがプロビジョンされたら、ただちに複製ボリュームに対してホストから読み取り/書き込みアクセスを行えます。 ただし、元のボリュームから複製へのデータ・コピーが完了するまで、スナップショットおよびレプリケーションは許可されません。

詳しくは、[複製のファイル・ボリュームの作成](how-to-create-duplicate-volume.html)を参照してください。


## 既存のレプリケーションのキャンセル

レプリケーションは、即時にキャンセルすることも、支払い日にキャンセルすることもでき、そこで請求が終了します。レプリケーションのキャンセルは、**「プライマリー」**タブまたは**「レプリカ」**タブで実行できます。

1. **「{{site.data.keyword.filestorage_short}}」**ページからボリュームをクリックします。
2. **「プライマリー」**タブまたは**「レプリカ」**タブで、**「アクション」**をクリックします。
3. **「レプリカのキャンセル」**を選択します。
4. キャンセルするタイミングを選択します。 **「即時」**または**「請求料金の確定日」**を選択し、**「続行」**をクリックしてください。
5. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**をクリックして、**「レプリカのキャンセル」**をクリックします。


## プライマリー・ボリュームをキャンセルしたときのレプリケーションのキャンセル

　プライマリー・ボリュームがキャンセルされると、レプリカ・データ・センターのレプリケーション・スケジュールとボリュームは削除されます。 レプリカは、**「{{site.data.keyword.filestorage_short}}」**ページからキャンセルされます。

 1. **「{{site.data.keyword.filestorage_short}}」**ページでボリュームを強調表示します。
 2. **「アクション」**をクリックし、**「{{site.data.keyword.filestorage_short}}のキャンセル (Cancel for {{site.data.keyword.filestorage_short}})」**を選択します。
 3. ボリュームをキャンセルするタイミングを選択します。**「即時」**または**「請求料金の確定日」**を選択し、**「続行」**をクリックしてください。
 4. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**をクリックして、**「キャンセル」**をクリックします。
